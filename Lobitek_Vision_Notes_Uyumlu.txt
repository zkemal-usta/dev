# LOBITEK VISION - TEKNİK DOKÜMAN
# 3 Kameralı Stereo Derinlik, Engel Algılama ve Rota Planlama

(Bu doküman Apple Notes ve diğer not uygulamalarına doğrudan yapıştırılmaya uygun, düz metin formatında hazırlanmıştır.)

---

## BÖLÜM 1: 3 Kameralı Stereo Vizyon ve Derinlik Matematiği

### 1. Giriş
Bu bölüm, 3 kameralı sistem (Trifocal Tensor) kullanarak derinlik kestirimi ve üçgenleme prensiplerini açıklar.

### 2. Pinhole Kamera Modeli (İğne Deliği Modeli)
Her bir kamera için görüntü oluşumu şu denklemle ifade edilir:

    s * [u, v, 1]ᵀ = K * [R | t] * [X, Y, Z, 1]ᵀ

Burada:
- s: Ölçek faktörü
- K: İç parametre matrisi
- R: Rotasyon matrisi
- t: Öteleme vektörü
- [u, v]: Piksel koordinatları
- [X, Y, Z]: 3B Dünya koordinatları

**İç Parametre Matrisi (K):**
    
    | f_x  0   c_x |
    |  0  f_y  c_y |
    |  0   0    1  |

- f_x, f_y: Odak uzaklıkları
- c_x, c_y: Görüntü merkezi

### 3. Derinlik (Z) Hesabı
İki kamera arasındaki yatay mesafeye "Baseline" (B) denir. Sol ve sağ görüntüdeki nesne kaymasına "Disparity" (d) denir.

    d = x_sol - x_sag

**Derinlik Formülü:**

    Z = (f * B) / d

- Z: Derinlik (Mesafe)
- f: Odak uzaklığı
- B: Kameralar arası mesafe
- d: Disparity (Piksel farkı)

*Önemli:* d (fark) sıfıra yaklaştıkça Z (mesafe) sonsuza gider.

### 4. 3 Kamera Avantajı
Üçüncü kamera dikey eksende ekstra bilgi sağlar. İki farklı derinlik tahmini (Z_yatay ve Z_dikey) ağırlıklı ortalama ile birleştirilir:

    Z_final = (w_h * Z_h + w_v * Z_v) / (w_h + w_v)

---

## BÖLÜM 2: Engel Algılama ve Haritalama

### 1. Nokta Bulutu Dönüşümü
Pikselden (u,v) ve Derinlikten (Z) 3B koordinata geçiş:

    X = (u - c_x) * Z / f_x
    Y = (v - c_y) * Z / f_y
    Z = Z

### 2. Zemin Filtreleme
Yükseklik (Y) belirli bir eşiğin üzerindeyse engeldir:

    Eğer P_y > h_esik  --> ENGEL
    Eğer P_y <= h_esik --> ZEMİN

### 3. Güvenlik Çemberi (Costmap)
Robotun çarpmasını önlemek için engeller sanal olarak şişirilir.

    Cost(mesafe) = exp(-alpha * (mesafe - R_robot))

---

## BÖLÜM 3: Engelden Kaçma Algoritmaları

### 1. Yapay Potansiyel Alanlar (APF)
Robotu hedefe çeken ve engelden iten kuvvetlerin toplamı:

    F_toplam = F_cekici + F_itici

**Çekici Kuvvet (Hedefe Doğru):**
    F_cekici = -k_att * (Robot_Konumu - Hedef_Konumu)

**İtici Kuvvet (Engelden Uzaklaşma):**
    F_itici = k_rep * (1/d - 1/d0) * (1/d^2)
    (Sadece robot engele çok yaklaştığında aktiftir)

---

## BÖLÜM 4: Rota Planlama

### 1. A* (A-Star) Algoritması
En kısa yolu bulmak için kullanılan maliyet fonksiyonu:

    f(n) = g(n) + h(n)

- g(n): Başlangıçtan şu ana kadar gelinen mesafe.
- h(n): Hedefe kalan tahmini kuş uçuşu mesafe (Heuristic).

**Heuristic (Öklid Mesafesi):**
    h(n) = karekök( (x_n - x_hedef)² + (y_n - y_hedef)² )

### 2. Rota Yumuşatma (Bezier Eğrileri)
Köşeli yolları yumuşatmak için parametrik denklem:

    B(t) = (1-t)² * P0  +  2(1-t)t * P1  +  t² * P2

Bu formül robotun keskin dönüşler yerine yumuşak kavisler çizmesini sağlar.
